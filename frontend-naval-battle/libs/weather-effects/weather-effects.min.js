(function(window) {
    function Weather(options) {
      this.options = options || {};
      this.type = this.options.type || 'rain';
      this.container = this.options.container || document.body;
      this.canvas = document.createElement('canvas');
      this.ctx = this.canvas.getContext('2d');
      this.container.appendChild(this.canvas);
      this.canvas.style.position = 'absolute';
      this.canvas.style.top = 0;
      this.canvas.style.left = 0;
      this.canvas.style.pointerEvents = 'none';
      this.resize();
      window.addEventListener('resize', this.resize.bind(this));
      this.particles = [];
      this.animate = this.animate.bind(this);
    }
  
    Weather.prototype.resize = function() {
      this.canvas.width = this.container.offsetWidth;
      this.canvas.height = this.container.offsetHeight;
    };
  
    Weather.prototype.start = function() {
      cancelAnimationFrame(this.frame);
      this.generateParticles();
      this.animate();
    };
  
    Weather.prototype.generateParticles = function() {
      const count = 100;
      this.particles = [];
      for (let i = 0; i < count; i++) {
        this.particles.push({
          x: Math.random() * this.canvas.width,
          y: Math.random() * this.canvas.height,
          speedY: 2 + Math.random() * 4,
          length: 10 + Math.random() * 20,
        });
      }
    };
  
    Weather.prototype.animate = function() {
      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
      this.ctx.strokeStyle = 'rgba(173,216,230,0.5)';
      this.ctx.lineWidth = 1;
      for (let i = 0; i < this.particles.length; i++) {
        const p = this.particles[i];
        this.ctx.beginPath();
        this.ctx.moveTo(p.x, p.y);
        this.ctx.lineTo(p.x, p.y + p.length);
        this.ctx.stroke();
        p.y += p.speedY;
        if (p.y > this.canvas.height) {
          p.y = -p.length;
          p.x = Math.random() * this.canvas.width;
        }
      }
      this.frame = requestAnimationFrame(this.animate);
    };
  
    window.Weather = Weather;
  })(window);
  